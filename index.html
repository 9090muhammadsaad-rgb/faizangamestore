<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faizan Game Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style id="theme-style">
        /* Base Colors & Typography (Light Mode Default) */
        :root {
            --primary-color: #3b82f6; /* Blue Accent */
            --background-color: #ffffff;
            --card-background: #f3f4f6;
            --text-color: #1f2937;
            --placeholder-color: #9ca3af;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
            --font-family: 'Poppins', sans-serif;
            --card-border-radius: 1rem;
        }

        /* Dark Mode Configuration */
        .dark-mode {
            --primary-color: #34d399; /* Neon Green Accent */
            --background-color: #121212;
            --card-background: #1f1f1f;
            --text-color: #e5e7eb;
            --placeholder-color: #6b7280;
            --shadow-color: rgba(255, 255, 255, 0.1);
        }

        /* Glassmorphism Effect (Optional) */
        .glass-blur .game-card {
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark-mode .glass-blur .game-card {
            background-color: rgba(31, 31, 31, 0.5);
        }

        /* --- Global Styles --- */
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s ease-out, visibility 0.5s;
        }

        .loader {
            border: 5px solid var(--card-background);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Header & Navigation --- */
        #header {
            position: relative;
            background-size: cover;
            background-position: center;
            height: 200px; /* Example height */
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            overflow: hidden;
            transition: transform var(--transition-speed), opacity var(--transition-speed);
            transform: translateY(-100%);
            opacity: 0;
            box-shadow: 0 4px 6px -1px var(--shadow-color);
        }

        #header.loaded {
            transform: translateY(0);
            opacity: 1;
        }

        #header h1 {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            animation: zoom-header 1s ease-out forwards;
        }

        @keyframes zoom-header {
            0% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        /* --- Main Container & Game Grid --- */
        main {
            padding: 1rem;
            flex-grow: 1;
        }

        .controls-bar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-bar {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--placeholder-color);
            background-color: var(--card-background);
            color: var(--text-color);
            font-size: 1rem;
            transition: all var(--transition-speed);
        }

        .search-bar:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        .settings-toggles {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px var(--shadow-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--background-color);
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: scale(1.05);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .btn-secondary {
            background-color: var(--card-background);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        /* Buttons Pulse Animation on Hover */
        .btn:hover {
            animation: pulse 0.5s infinite alternate;
        }
        @keyframes pulse {
            from { transform: scale(1.0); }
            to { transform: scale(1.02); }
        }


        /* Game Grid Layout */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* Game Card Styles */
        .game-card {
            background-color: var(--card-background);
            border-radius: var(--card-border-radius);
            padding: 1rem;
            box-shadow: 0 4px 10px var(--shadow-color);
            transition: all 0.3s ease-in-out;
            transform: translateY(20px);
            opacity: 0;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .game-card.visible {
            transform: translateY(0);
            opacity: 1;
        }

        .game-card:hover {
            transform: scale(1.03) translateY(-2px); /* Hover Zoom-in */
            box-shadow: 0 8px 16px var(--shadow-color);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .game-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .game-name {
            font-weight: 700;
            font-size: 1.25rem;
            margin: 0;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .game-details {
            font-size: 0.85rem;
            color: var(--placeholder-color);
            margin-top: 0.25rem;
        }

        .game-description {
            font-size: 0.9rem;
            margin: 0.75rem 0;
            height: 40px; /* Limit short description to 2 lines */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .download-btn {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
        }

        .retry-btn {
            display: none;
            background-color: #ef4444; /* Red for error/retry */
            color: white;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
        }

        /* Placeholder & Messages */
        .message-box {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            background-color: var(--card-background);
            border-radius: var(--card-border-radius);
            color: var(--placeholder-color);
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* --- Game Detail Modal --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-content {
            background-color: var(--background-color);
            margin: auto;
            padding: 1.5rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease-in-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.open .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .close-btn {
            color: var(--text-color);
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--primary-color);
        }

        .modal-header {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--card-background);
            border-radius: 0.5rem;
        }

        .modal-details div {
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .modal-details strong {
            display: block;
            font-size: 0.75rem;
            color: var(--placeholder-color);
            font-weight: 400;
            margin-bottom: 0.2rem;
        }

        .screenshots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .screenshots-grid img, .screenshots-grid video {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
            object-fit: cover;
            box-shadow: 0 2px 5px var(--shadow-color);
            cursor: zoom-in;
        }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.85rem;
            margin-top: 2rem;
            border-top: 1px solid var(--card-background);
            color: var(--placeholder-color);
        }

        footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Media Queries for Mobile-First Design Adjustments */
        @media (max-width: 600px) {
            #header { height: 150px; }
            #header h1 { font-size: 2rem; }
            .game-card { padding: 0.75rem; }
            .game-icon { width: 50px; height: 50px; }
            .game-name { font-size: 1.1rem; }
            .controls-bar { flex-direction: column; }
            .settings-toggles { justify-content: space-between; }
        }
    </style>
</head>
<body class="light-mode">
    <div id="loading-screen">
        <div class="loader"></div>
    </div>

    <header id="header">
        <div class="header-content">
            <h1 id="header-text">Faizan Store</h1>
        </div>
    </header>

    <main>
        <div class="controls-bar">
            <input type="text" id="search-input" class="search-bar" placeholder="Search games by name, package, or keywords...">

            <div class="settings-toggles">
                <button id="theme-toggle" class="btn btn-secondary">
                    <span class="icon">üåô</span> Dark Mode
                </button>
                
                <input type="file" id="bg-file-input" accept="image/*" style="display: none;">
                <button id="bg-customizer-btn" class="btn btn-secondary">
                    <span class="icon">üñºÔ∏è</span> Set Background
                </button>
                <button id="bg-reset-btn" class="btn btn-secondary" style="display: none;">
                    <span class="icon">‚ùå</span> Reset Background
                </button>

                <button id="fullscreen-toggle" class="btn btn-secondary">
                    <span class="icon">üñ•Ô∏è</span> Fullscreen
                </button>
                
                <button id="help-button" class="btn btn-secondary">
                    <span class="icon">üìß</span> Help
                </button>
            </div>
        </div>

        <div id="game-grid">
            <div id="no-games-message" class="message-box" style="display: none;">
                <p>No Games Uploaded Yet</p>
            </div>
            <div id="no-search-results" class="message-box" style="display: none;">
                <p>No game found!</p>
            </div>
        </div>
    </main>

    <footer>
        <p>All game data loaded from raw GitHub content.</p>
        <p><a href="#" id="copyright-link">(c) Saad</a></p>
        <button id="back-button" class="btn btn-primary" style="margin-top: 10px;">
            <span class="icon">‚¨ÖÔ∏è</span> Go Back
        </button>
    </footer>
    
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="modal-header">
                <img id="modal-icon" class="game-icon" src="" alt="Game Icon">
                <div>
                    <h2 id="modal-name"></h2>
                    <p id="modal-compatibility" class="game-details"></p>
                </div>
            </div>

            <div class="modal-details">
                <div><strong>Package Name</strong><span id="modal-pkg"></span></div>
                <div><strong>Release Date</strong><span id="modal-date"></span></div>
                <div><strong>File Size</strong><span id="modal-size"></span></div>
            </div>

            <p id="modal-full-description"></p>
            
            <div class="card-actions">
                <a id="modal-download-link" href="#" target="_blank" class="btn btn-primary download-btn">Download Game</a>
                <button id="modal-retry-btn" class="retry-btn">Retry Download</button>
            </div>
            
            <h3>Screenshots & Gameplay</h3>
            <div id="modal-assets" class="screenshots-grid">
                </div>
        </div>
    </div>

    <script>
        const REPO_OWNER = '9090muhammadsaad-rgb';
        const REPO_NAME = 'faizangamestore';
        const GITHUB_BRANCH = 'main'; // Assumed default branch, adjust if needed
        const BASE_RAW_URL = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${GITHUB_BRANCH}/`;
        const API_CONTENTS_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/`; // Alternative API

        const elements = {
            loadingScreen: document.getElementById('loading-screen'),
            header: document.getElementById('header'),
            headerText: document.getElementById('header-text'),
            gameGrid: document.getElementById('game-grid'),
            searchInput: document.getElementById('search-input'),
            themeToggle: document.getElementById('theme-toggle'),
            bgCustomizerBtn: document.getElementById('bg-customizer-btn'),
            bgFileInput: document.getElementById('bg-file-input'),
            bgResetBtn: document.getElementById('bg-reset-btn'),
            fullscreenToggle: document.getElementById('fullscreen-toggle'),
            helpButton: document.getElementById('help-button'),
            copyrightLink: document.getElementById('copyright-link'),
            backButton: document.getElementById('back-button'),
            noGamesMessage: document.getElementById('no-games-message'),
            noSearchResults: document.getElementById('no-search-results'),
            modal: document.getElementById('game-modal'),
            modalClose: document.querySelector('.close-btn'),
            modalIcon: document.getElementById('modal-icon'),
            modalName: document.getElementById('modal-name'),
            modalCompatibility: document.getElementById('modal-compatibility'),
            modalPkg: document.getElementById('modal-pkg'),
            modalDate: document.getElementById('modal-date'),
            modalSize: document.getElementById('modal-size'),
            modalFullDescription: document.getElementById('modal-full-description'),
            modalDownloadLink: document.getElementById('modal-download-link'),
            modalRetryBtn: document.getElementById('modal-retry-btn'),
            modalAssets: document.getElementById('modal-assets'),
        };

        let allGamesData = [];

        // --- Core Functions: File Loading & Fallback ---

        // Helper to fetch text content
        async function fetchText(url, fallback = 'N/A') {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('File not found');
                return (await response.text()).trim();
            } catch (error) {
                console.warn(`Could not fetch ${url}: ${error.message}`);
                return fallback;
            }
        }

        // Helper to check for image existence
        function getImageUrl(path, fallbackIcon = 'no_icon.png') {
            const jpgUrl = `${BASE_RAW_URL}${path}/icon.jpg`;
            const pngUrl = `${BASE_RAW_URL}${path}/icon.png`;

            // Simple check (in a real app, you'd use a HEAD request or rely on a pre-indexed list)
            // For GitHub Pages, we'll try to load them and use JS onerror fallback.
            // But for initial card creation, we use a simple priority:
            const iconUrl = `${BASE_RAW_URL}${path}/icon.jpg`; // Try JPG first
            return {
                jpg: iconUrl,
                png: pngUrl,
                fallback: fallbackIcon // The final fallback
            };
        }
        
        // Helper to load assets from the folder (simulated)
        async function fetchAssets(gamePath) {
            // NOTE: Directly listing files in a folder on raw.githubusercontent.com is NOT possible.
            // A realistic non-API solution is to list expected files or use the GitHub API (with its limits).
            
            // For this project, we assume a pre-indexed list (e.g., in a JSON) or use hardcoded check
            // For the sake of completing the prompt's logic, we will check for common names.
            
            const assetNames = ['screenshot1.jpg', 'screenshot2.png', 'gameplay.mp4'];
            const assets = [];

            for (const name of assetNames) {
                const url = `${BASE_RAW_URL}${gamePath}/assets/${name}`;
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    if (response.ok) {
                        assets.push({
                            url: url,
                            type: name.endsWith('.mp4') ? 'video' : 'image'
                        });
                    }
                } catch (e) {
                    // Ignore not found assets
                }
            }
            return assets;
        }

        // --- Game Data Structure (Reliable Static Index Alternative) ---

        /*
            *** IMPORTANT NOTE ON GAME DETECTION SYSTEM ***
            
            Client-side JavaScript cannot directly list directories in a raw GitHub repository
            (i.e., on raw.githubusercontent.com).
            The recommended, reliable, and CORS-safe solution for a GitHub Pages *static* site
            is to use a manually maintained index file (like games_index.json) that lists the game folders.
            
            When you add a new game folder, you must update this file.
            
            File structure: /faizangamestore/games_index.json
            
            games_index.json content:
            [
              "minecraft_game",
              "another_game__(game)",
              "third_game__(game)"
              // etc.
            ]
        */

        async function fetchGameFolders() {
            // 1. Fetch the index file (reliable static method for GitHub Pages)
            const indexUrl = `${BASE_RAW_URL}games_index.json`;
            try {
                const response = await fetch(indexUrl);
                if (!response.ok) throw new Error('Game index not found');
                const folderList = await response.json();
                
                // Filter folders ending with __(game) as per prompt
                return folderList.filter(name => name.endsWith('__(game)'));
                
            } catch (error) {
                console.error('Error fetching game index:', error);
                
                // --- Alternative: GitHub API for Directory Listing (Requires no auth for public repo, but has rate limits)
                // This is less reliable for a high-traffic site than a static index file.
                /*
                try {
                    const apiResponse = await fetch(API_CONTENTS_URL);
                    if (!apiResponse.ok) throw new Error('GitHub API access failed');
                    const contents = await apiResponse.json();
                    
                    return contents
                        .filter(item => item.type === 'dir' && item.name.endsWith('__(game)'))
                        .map(item => item.name);
                } catch (apiError) {
                    console.error('Error with GitHub Contents API:', apiError);
                    return [];
                }
                */
                
                return []; // Fallback to empty list
            }
        }
        
        async function loadGameData(folderPath) {
            const gameData = { path: folderPath, name: 'N/A', description: 'N/A', keywords: [] };
            const baseDir = `${folderPath}/`;
            const appInfoDir = `${baseDir}app_info/`;
            
            // Icon Fallback Logic
            const iconUrls = getImageUrl(folderPath);
            gameData.icon = iconUrls.jpg; // Primary URL
            
            // Load essential info
            gameData.name = await fetchText(`${appInfoDir}app_name.txt`, 'Game Name N/A');
            gameData.pkg = await fetchText(`${appInfoDir}pkg.txt`, 'N/A');
            gameData.date = await fetchText(`${appInfoDir}date.txt`, 'N/A');
            gameData.size = await fetchText(`${appInfoDir}size.txt`, 'N/A');
            gameData.work = await fetchText(`${appInfoDir}work.txt`, 'N/A');
            
            // Load descriptions
            const fullDesc = await fetchText(`${appInfoDir}description.txt`, 'No full description available.');
            gameData.fullDescription = fullDesc;
            
            const downloadLink = await fetchText(`${baseDir}description.txt`, '#');
            gameData.downloadLink = downloadLink;
            
            // Extract Keywords and Short Description (assumes short description is the first non-keyword line)
            const lines = fullDesc.split('\n');
            let shortDesc = '';
            for (const line of lines) {
                if (line.startsWith('#')) {
                    gameData.keywords.push(line.substring(1).trim().toLowerCase());
                } else if (!shortDesc && line.trim()) {
                    shortDesc = line.trim();
                }
            }
            gameData.shortDescription = shortDesc || 'No short description available.';
            
            // Pre-fetch assets (optional, can be done on modal open for true lazy loading)
            // gameData.assets = await fetchAssets(folderPath); 
            
            return gameData;
        }

        // --- UI & Rendering Functions ---

        function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';
            card.dataset.path = game.path;
            card.style.animationDelay = `${Math.random() * 0.3}s`; // Staggered slide-up
            
            card.innerHTML = `
                <div class="card-header">
                    <img class="game-icon" src="${game.icon}" alt="${game.name} Icon" loading="lazy" 
                        onerror="this.onerror=null; this.src='${getImageUrl(game.path).png}'; 
                        this.onerror=function(){this.src='no_icon.png'}">
                    <div>
                        <h3 class="game-name">${game.name}</h3>
                        <p class="game-details">${game.size} ‚Ä¢ ${game.date}</p>
                    </div>
                </div>
                <p class="game-description">${game.shortDescription}</p>
                <div class="card-actions">
                    <a href="${game.downloadLink}" target="_blank" class="btn btn-primary download-btn" onclick="handleDownload(event)">Download</a>
                    <button class="retry-btn" onclick="handleDownload(event)">Retry Download</button>
                </div>
            `;
            
            // Click listener for opening the modal
            card.addEventListener('click', (e) => {
                if (!e.target.closest('.card-actions')) {
                    openModal(game);
                }
            });

            return card;
        }

        function renderGames(games) {
            elements.gameGrid.innerHTML = '';
            elements.noGamesMessage.style.display = 'none';
            elements.noSearchResults.style.display = 'none';

            if (allGamesData.length === 0) {
                elements.noGamesMessage.style.display = 'block';
                return;
            }

            if (games.length === 0) {
                elements.noSearchResults.style.display = 'block';
                return;
            }

            games.forEach((game, index) => {
                const card = createGameCard(game);
                elements.gameGrid.appendChild(card);
                
                // Fade-in and slide-up effect
                setTimeout(() => {
                    card.classList.add('visible');
                }, index * 50); // Small delay for staggering effect
            });
        }
        
        // --- Game Modal Logic ---

        async function openModal(game) {
            // Set basic info
            elements.modalName.textContent = game.name;
            elements.modalIcon.src = game.icon;
            elements.modalCompatibility.textContent = `Compatibility: ${game.work}`;
            elements.modalPkg.textContent = game.pkg;
            elements.modalDate.textContent = game.date;
            elements.modalSize.textContent = game.size;
            elements.modalFullDescription.textContent = game.fullDescription;
            elements.modalDownloadLink.href = game.downloadLink;
            
            // Reset and show modal
            elements.modalAssets.innerHTML = 'Loading assets...';
            elements.modal.style.display = 'flex';
            elements.modal.classList.add('open');

            // Load assets (lazy load on modal open)
            const assets = await fetchAssets(game.path);
            elements.modalAssets.innerHTML = '';
            
            if (assets.length === 0) {
                elements.modalAssets.innerHTML = '<p class="game-details">No screenshots or gameplay videos available.</p>';
            } else {
                assets.forEach(asset => {
                    if (asset.type === 'image') {
                        const img = document.createElement('img');
                        img.src = asset.url;
                        img.alt = 'Screenshot';
                        img.loading = 'lazy';
                        elements.modalAssets.appendChild(img);
                    } else if (asset.type === 'video') {
                        const video = document.createElement('video');
                        video.src = asset.url;
                        video.controls = true;
                        video.loop = true;
                        video.autoplay = false;
                        elements.modalAssets.appendChild(video);
                    }
                });
            }
        }

        function closeModal() {
            elements.modal.classList.remove('open');
            setTimeout(() => {
                elements.modal.style.display = 'none';
            }, 300);
        }

        // --- Error/Download Handling ---

        function handleDownload(event) {
            const btn = event.target;
            const link = btn.closest('.card-actions').querySelector('.download-btn');
            const retry = btn.closest('.card-actions').querySelector('.retry-btn');

            // Simple error simulation/handling (Actual download success cannot be reliably detected cross-domain)
            if (link.href === '#') {
                event.preventDefault();
                alert('Download link not found. Showing retry button.');
                link.style.display = 'none';
                retry.style.display = 'block';
            } else {
                // Assume successful initiation of download
                link.style.display = 'block';
                retry.style.display = 'none';
            }
        }
        
        // --- Initialization & Main Flow ---

        async function init() {
            // 1. Theme/Background Setup
            loadTheme();
            loadBackground();
            
            // 2. Load Header
            loadHeader();

            // 3. Load Game Data
            const folders = await fetchGameFolders();
            
            // Load all game data concurrently for performance
            allGamesData = await Promise.all(folders.map(loadGameData));

            // 4. Render and Hide Loading Screen
            renderGames(allGamesData);

            elements.loadingScreen.style.opacity = '0';
            elements.header.classList.add('loaded'); // Header fade-down animation
            setTimeout(() => {
                elements.loadingScreen.style.display = 'none';
            }, 500);
        }

        function loadHeader() {
            const header = elements.header;
            const jpgUrl = `${BASE_RAW_URL}header.jpg`;
            const pngUrl = `${BASE_RAW_URL}header.png`;

            // Try to load JPG, then PNG, else keep text
            const img = new Image();
            img.onload = () => {
                header.style.backgroundImage = `url('${img.src}')`;
                elements.headerText.style.color = 'white';
            };
            img.onerror = () => {
                // Try PNG fallback
                const png = new Image();
                png.onload = () => {
                    header.style.backgroundImage = `url('${png.src}')`;
                    elements.headerText.style.color = 'white';
                };
                png.onerror = () => {
                    // Both missing - show plain text header
                    header.style.backgroundImage = 'none';
                    header.style.backgroundColor = 'var(--primary-color)';
                    elements.headerText.style.color = 'white';
                };
                png.src = pngUrl;
            };
            img.src = jpgUrl;
        }
        
        // --- Feature Implementations ---

        // Theme Toggle
        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'light-mode';
            document.body.className = theme;
            elements.themeToggle.innerHTML = theme === 'dark-mode' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        elements.themeToggle.addEventListener('click', () => {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            const theme = isDarkMode ? 'dark-mode' : 'light-mode';
            document.body.className = theme;
            localStorage.setItem('theme', theme);
            elements.themeToggle.innerHTML = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        });

        // Background Customizer
        function loadBackground() {
            const bg = localStorage.getItem('customBg');
            if (bg) {
                document.body.style.backgroundImage = `url('${bg}')`;
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundSize = 'cover';
                elements.bgResetBtn.style.display = 'inline-block';
            } else {
                document.body.style.backgroundImage = 'none';
                elements.bgResetBtn.style.display = 'none';
            }
        }

        elements.bgCustomizerBtn.addEventListener('click', () => elements.bgFileInput.click());
        elements.bgFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    localStorage.setItem('customBg', event.target.result);
                    loadBackground();
                };
                reader.readAsDataURL(file);
            }
        });

        elements.bgResetBtn.addEventListener('click', () => {
            localStorage.removeItem('customBg');
            loadBackground();
        });

        // Fullscreen Mode
        elements.fullscreenToggle.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable fullscreen mode: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
        });
        
        // Back Button
        elements.backButton.addEventListener('click', () => {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                alert("Cannot go back further in history.");
            }
        });

        // Copyright Alert
        elements.copyrightLink.addEventListener('click', (e) => {
            e.preventDefault();
            alert('(c) Saad');
        });
        
        // Help Option
        elements.helpButton.addEventListener('click', () => {
            window.location.href = 'mailto:muhmmadsaad226@gmail.com';
        });

        // Modal Close Listener
        elements.modalClose.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target === elements.modal) {
                closeModal();
            }
        });
        
        // --- Search & Filter System ---
        elements.searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            if (!searchTerm) {
                renderGames(allGamesData);
                return;
            }

            const filteredGames = allGamesData.filter(game => {
                // Search by App name
                if (game.name.toLowerCase().includes(searchTerm)) return true;
                // Search by Package name
                if (game.pkg.toLowerCase().includes(searchTerm)) return true;
                // Search by Keywords
                if (game.keywords.some(keyword => keyword.includes(searchTerm))) return true;
                
                return false;
            });

            renderGames(filteredGames);
        });

        // --- Other Setup ---

        // Smooth Scroll Animation (Intersection Observer for Cards)
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        // Add observer to all cards that get rendered later (will be called in renderGames)
        const originalRenderGames = renderGames;
        renderGames = (games) => {
            originalRenderGames(games);
            document.querySelectorAll('.game-card').forEach(card => {
                observer.observe(card);
            });
        };
        
        // Start the application
        window.onload = init;
    </script>
</body>
</html>
// (C) OWNER By Saad
